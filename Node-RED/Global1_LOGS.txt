[
    {
        "id": "6472f1e7.097c28",
        "type": "tab",
        "label": "LOGs",
        "disabled": false,
        "info": ""
    },
    {
        "id": "3d1d254f.9a4e02",
        "type": "change",
        "z": "6472f1e7.097c28",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "LOGhasta",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 530,
        "y": 780,
        "wires": [
            []
        ]
    },
    {
        "id": "3e96d11c.ff676e",
        "type": "ui_date_picker",
        "z": "6472f1e7.097c28",
        "name": "",
        "label": "Fecha de final",
        "group": "3c571dec.0a71b2",
        "order": 6,
        "width": 0,
        "height": 0,
        "passthru": true,
        "topic": "",
        "x": 300,
        "y": 780,
        "wires": [
            [
                "3d1d254f.9a4e02"
            ]
        ]
    },
    {
        "id": "5cf87c3b.0b615c",
        "type": "change",
        "z": "6472f1e7.097c28",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "LOGdesde",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 530,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "98a2adf4.e7e4f",
        "type": "ui_date_picker",
        "z": "6472f1e7.097c28",
        "name": "",
        "label": "Fecha de inicio",
        "group": "3c571dec.0a71b2",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "topic": "",
        "x": 300,
        "y": 740,
        "wires": [
            [
                "5cf87c3b.0b615c"
            ]
        ]
    },
    {
        "id": "209c817e.8399b6",
        "type": "change",
        "z": "6472f1e7.097c28",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "LOGsortby",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 530,
        "y": 860,
        "wires": [
            []
        ]
    },
    {
        "id": "58dd0e47.bb3f38",
        "type": "ui_dropdown",
        "z": "6472f1e7.097c28",
        "name": "",
        "label": "Ordenar Por:",
        "tooltip": "",
        "place": "Select option",
        "group": "3c571dec.0a71b2",
        "order": 9,
        "width": 0,
        "height": 0,
        "passthru": true,
        "options": [
            {
                "label": "Fecha",
                "value": "Date",
                "type": "str"
            },
            {
                "label": "Conexion",
                "value": "Online",
                "type": "str"
            },
            {
                "label": "Placa",
                "value": "Placa",
                "type": "str"
            },
            {
                "label": "CHIP ID",
                "value": "CHIPID",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "",
        "x": 290,
        "y": 860,
        "wires": [
            [
                "209c817e.8399b6"
            ]
        ]
    },
    {
        "id": "6c30b934.a32728",
        "type": "ui_switch",
        "z": "6472f1e7.097c28",
        "name": "",
        "label": "Orden: Des/Asen",
        "tooltip": "",
        "group": "3c571dec.0a71b2",
        "order": 10,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "style": "",
        "onvalue": "1",
        "onvalueType": "num",
        "onicon": "",
        "oncolor": "",
        "offvalue": "-1",
        "offvalueType": "num",
        "officon": "",
        "offcolor": "",
        "x": 310,
        "y": 820,
        "wires": [
            [
                "8cdcca4.9d21ab8"
            ]
        ]
    },
    {
        "id": "8cdcca4.9d21ab8",
        "type": "change",
        "z": "6472f1e7.097c28",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "LOGad",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 520,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "d9921e05.c0ce4",
        "type": "ui_numeric",
        "z": "6472f1e7.097c28",
        "name": "",
        "label": "Limite Busq.",
        "tooltip": "",
        "group": "3c571dec.0a71b2",
        "order": 8,
        "width": 0,
        "height": 0,
        "passthru": true,
        "topic": "",
        "format": "{{value}}",
        "min": 0,
        "max": "10000",
        "step": 1,
        "x": 290,
        "y": 900,
        "wires": [
            [
                "f11d94b8.585368"
            ]
        ]
    },
    {
        "id": "f11d94b8.585368",
        "type": "change",
        "z": "6472f1e7.097c28",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "LOGlimit",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 530,
        "y": 900,
        "wires": [
            []
        ]
    },
    {
        "id": "e5fd50e6.50c89",
        "type": "mongodb out",
        "z": "6472f1e7.097c28",
        "mongodb": "3284a27d.270ace",
        "name": "",
        "collection": "_USERS",
        "payonly": true,
        "upsert": true,
        "multi": true,
        "operation": "store",
        "x": 1440,
        "y": 700,
        "wires": []
    },
    {
        "id": "ffeb25d9.800ab8",
        "type": "function",
        "z": "6472f1e7.097c28",
        "name": "set msg._id",
        "func": "msg._id = {\"CHIPID\" : msg.payload.CHIPID} ;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 730,
        "y": 660,
        "wires": [
            [
                "ce6ef657.bbdb28"
            ]
        ]
    },
    {
        "id": "da1858fb.1ca6e8",
        "type": "switch",
        "z": "6472f1e7.097c28",
        "name": "IsCHIPID",
        "property": "_id",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1020,
        "y": 660,
        "wires": [
            [
                "baa1c0f8.4b617",
                "bc3d32f5.847a5",
                "d3d49ed5.b4081"
            ]
        ]
    },
    {
        "id": "983f2d68.e4d07",
        "type": "link in",
        "z": "6472f1e7.097c28",
        "name": "USER_conexion",
        "links": [
            "2c54ad31.535242",
            "3a6e3253.6e2e3e",
            "4b719b04.9bff84",
            "64efdf85.5502",
            "77d5aa6e.36d744",
            "d166de5b.65a81"
        ],
        "x": 235,
        "y": 620,
        "wires": [
            [
                "ee4c9921.5fffc8"
            ]
        ]
    },
    {
        "id": "baa1c0f8.4b617",
        "type": "switch",
        "z": "6472f1e7.097c28",
        "name": "IsPLACA",
        "property": "payload.placa",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1220,
        "y": 740,
        "wires": [
            [
                "e5fd50e6.50c89"
            ],
            [
                "2aa888a8.2034b8"
            ]
        ]
    },
    {
        "id": "89f9e4ad.bd3a28",
        "type": "mongodb in",
        "z": "6472f1e7.097c28",
        "mongodb": "3284a27d.270ace",
        "name": "",
        "collection": "_USERS",
        "operation": "count",
        "x": 1440,
        "y": 580,
        "wires": [
            [
                "24de3b5c.e12a94"
            ]
        ]
    },
    {
        "id": "bc3d32f5.847a5",
        "type": "change",
        "z": "6472f1e7.097c28",
        "name": "set null",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1220,
        "y": 580,
        "wires": [
            [
                "89f9e4ad.bd3a28"
            ]
        ]
    },
    {
        "id": "24de3b5c.e12a94",
        "type": "change",
        "z": "6472f1e7.097c28",
        "name": "set flow.numUsers",
        "rules": [
            {
                "t": "set",
                "p": "numUsers",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1850,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "2aa888a8.2034b8",
        "type": "function",
        "z": "6472f1e7.097c28",
        "name": "USER_check",
        "func": "\n\nvar valor = msg.payload.CHIPID;\nmsg.payload={\"CHIPID\":valor};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1370,
        "y": 780,
        "wires": [
            [
                "ac9a0fb5.316be",
                "36d60412.82e6ec"
            ]
        ]
    },
    {
        "id": "36d60412.82e6ec",
        "type": "mongodb in",
        "z": "6472f1e7.097c28",
        "mongodb": "3284a27d.270ace",
        "name": "",
        "collection": "_USERS",
        "operation": "count",
        "x": 1740,
        "y": 820,
        "wires": [
            [
                "f1c00d65.035a2"
            ]
        ]
    },
    {
        "id": "f1c00d65.035a2",
        "type": "change",
        "z": "6472f1e7.097c28",
        "name": "set flow.checkCollision",
        "rules": [
            {
                "t": "set",
                "p": "checkCollision",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2120,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "460214f7.3e731c",
        "type": "switch",
        "z": "6472f1e7.097c28",
        "name": "CheckCollisions",
        "property": "checkCollision",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1840,
        "y": 740,
        "wires": [
            [
                "620bb7c4.205208"
            ],
            [
                "998efb16.198128",
                "3f2f5c5f.4c6154"
            ]
        ]
    },
    {
        "id": "ac9a0fb5.316be",
        "type": "delay",
        "z": "6472f1e7.097c28",
        "name": "",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1670,
        "y": 740,
        "wires": [
            [
                "460214f7.3e731c"
            ]
        ]
    },
    {
        "id": "a1238310.b0be",
        "type": "mqtt out",
        "z": "6472f1e7.097c28",
        "name": "",
        "topic": "infind/GRUPO1/ESP0/config/placa",
        "qos": "",
        "retain": "",
        "broker": "6042ac30.01c774",
        "x": 3320,
        "y": 760,
        "wires": []
    },
    {
        "id": "998efb16.198128",
        "type": "function",
        "z": "6472f1e7.097c28",
        "name": "Recover Data",
        "func": "var ChipID=msg.payload.CHIPID;\n\n\nmsg.payload=\n[\n    { \"$match\": { \"CHIPID\": ChipID } },\n    { \"$project\": {\n        \"CHIPID\": \"$CHIPID\",\n        \"placa\": \"$placa\",\n        \"grupo\": \"$grupo\"\n        }\n    }\n];\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2100,
        "y": 760,
        "wires": [
            [
                "92b3439a.d58f8"
            ]
        ]
    },
    {
        "id": "92b3439a.d58f8",
        "type": "mongodb in",
        "z": "6472f1e7.097c28",
        "mongodb": "3284a27d.270ace",
        "name": "",
        "collection": "_USERS",
        "operation": "aggregate",
        "x": 2340,
        "y": 760,
        "wires": [
            [
                "3cabb6f8.23fc0a"
            ]
        ]
    },
    {
        "id": "3cabb6f8.23fc0a",
        "type": "function",
        "z": "6472f1e7.097c28",
        "name": "ARRAY[0]2OBJECT",
        "func": "\nvar payload = msg.payload[0];\nmsg.payload=payload;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2600,
        "y": 760,
        "wires": [
            [
                "fa52ede3.bd3d1"
            ]
        ]
    },
    {
        "id": "ce6ef657.bbdb28",
        "type": "function",
        "z": "6472f1e7.097c28",
        "name": "+ fecha",
        "func": "\nmsg.payload.date = new Date();\n\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 880,
        "y": 660,
        "wires": [
            [
                "da1858fb.1ca6e8"
            ]
        ]
    },
    {
        "id": "35d43c91.997cb4",
        "type": "function",
        "z": "6472f1e7.097c28",
        "name": "newPlaca",
        "func": "var ChipID=msg.payload.CHIPID;\nvar date = msg.payload.date;\nvar numUsers = flow.get(\"numUsers\");\nvar placa = numUsers + 1 ;\n\n\nmsg.payload=\n{\n    \"CHIPID\":ChipID,\n    \"grupo\" : 1,\n    \"placa\":placa,\n    \"date\":date\n    \n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2380,
        "y": 660,
        "wires": [
            [
                "38beef61.7c777"
            ]
        ]
    },
    {
        "id": "abf6843e.da70e8",
        "type": "change",
        "z": "6472f1e7.097c28",
        "name": "",
        "rules": [
            {
                "t": "delete",
                "p": "payload._id",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3043.7585525512695,
        "y": 759.9727783203125,
        "wires": [
            [
                "a1238310.b0be"
            ]
        ]
    },
    {
        "id": "d3d49ed5.b4081",
        "type": "change",
        "z": "6472f1e7.097c28",
        "name": "set flow.oldPlaca",
        "rules": [
            {
                "t": "set",
                "p": "oldPlaca",
                "pt": "flow",
                "to": "payload.placa",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1250,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "fa52ede3.bd3d1",
        "type": "switch",
        "z": "6472f1e7.097c28",
        "name": "check ChangePlaca",
        "property": "payload.placa",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "oldPlaca",
                "vt": "flow"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 2820,
        "y": 760,
        "wires": [
            [
                "abf6843e.da70e8"
            ]
        ]
    },
    {
        "id": "ee4c9921.5fffc8",
        "type": "switch",
        "z": "6472f1e7.097c28",
        "name": "check Online conection",
        "property": "payload.online",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 390,
        "y": 620,
        "wires": [
            [
                "ed77c660.a24738"
            ]
        ]
    },
    {
        "id": "620bb7c4.205208",
        "type": "function",
        "z": "6472f1e7.097c28",
        "name": "set msg._id",
        "func": "msg._id = {\"CHIPID\" : msg.payload.CHIPID} ;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2090,
        "y": 660,
        "wires": [
            [
                "5cbbb084.6c8bc"
            ]
        ]
    },
    {
        "id": "5cbbb084.6c8bc",
        "type": "function",
        "z": "6472f1e7.097c28",
        "name": "+ fecha",
        "func": "\nmsg.payload.date = new Date();\n\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2240,
        "y": 660,
        "wires": [
            [
                "35d43c91.997cb4"
            ]
        ]
    },
    {
        "id": "38beef61.7c777",
        "type": "mongodb out",
        "z": "6472f1e7.097c28",
        "mongodb": "3284a27d.270ace",
        "name": "",
        "collection": "_USERS",
        "payonly": true,
        "upsert": true,
        "multi": true,
        "operation": "store",
        "x": 2600,
        "y": 660,
        "wires": []
    },
    {
        "id": "3f2f5c5f.4c6154",
        "type": "function",
        "z": "6472f1e7.097c28",
        "name": "Placa_check",
        "func": "\n\nvar valor = msg.payload.placa;\nmsg.payload={\"placa\":valor};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2089.765739440918,
        "y": 708.2500658035278,
        "wires": [
            [
                "e8647e8e.36831"
            ]
        ]
    },
    {
        "id": "e8647e8e.36831",
        "type": "mongodb in",
        "z": "6472f1e7.097c28",
        "mongodb": "3284a27d.270ace",
        "name": "",
        "collection": "_USERS",
        "operation": "count",
        "x": 2319.0156860351562,
        "y": 706.250075340271,
        "wires": [
            [
                "94d26640.700518"
            ]
        ]
    },
    {
        "id": "94d26640.700518",
        "type": "change",
        "z": "6472f1e7.097c28",
        "name": "set flow.checkPlacaCollision",
        "rules": [
            {
                "t": "set",
                "p": "checkPlacaCollision",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2590.7656898498535,
        "y": 705.2501363754272,
        "wires": [
            []
        ]
    },
    {
        "id": "ed77c660.a24738",
        "type": "function",
        "z": "6472f1e7.097c28",
        "name": "set format",
        "func": "var CHIPID = msg.payload.CHIPID;\nvar GRUPO = msg.payload.grupo;\nvar PLACA = msg.payload.placa;\n\nmsg.payload={};\nmsg.payload.CHIPID= CHIPID;\nmsg.payload.grupo=GRUPO\nmsg.payload.placa=PLACA\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 580,
        "y": 660,
        "wires": [
            [
                "ffeb25d9.800ab8"
            ]
        ]
    },
    {
        "id": "6cc67f76.461d3",
        "type": "ui_form",
        "z": "6472f1e7.097c28",
        "name": "",
        "label": "Nuevo Usuario",
        "group": "852b60b9.26366",
        "order": 2,
        "width": 0,
        "height": 0,
        "options": [
            {
                "label": "CHIP ID",
                "value": "CHIPID",
                "type": "text",
                "required": true
            },
            {
                "label": "Placa",
                "value": "placa",
                "type": "text",
                "required": true
            },
            {
                "label": "Grupo",
                "value": "grupo",
                "type": "text",
                "required": false
            }
        ],
        "formValue": {
            "CHIPID": "",
            "placa": "",
            "grupo": ""
        },
        "payload": "",
        "submit": "Añadir/Modificar(por CHIPID)",
        "cancel": "Cancelar",
        "topic": "",
        "x": 300,
        "y": 660,
        "wires": [
            [
                "ed77c660.a24738"
            ]
        ]
    },
    {
        "id": "ae25beef.72656",
        "type": "ui_form",
        "z": "6472f1e7.097c28",
        "name": "",
        "label": "Borrar Usuario",
        "group": "852b60b9.26366",
        "order": 3,
        "width": "6",
        "height": "3",
        "options": [
            {
                "label": "Placa",
                "value": "placa",
                "type": "text",
                "required": true
            }
        ],
        "formValue": {
            "placa": ""
        },
        "payload": "",
        "submit": "Borrar Usuario",
        "cancel": "Cancelar",
        "topic": "",
        "x": 300,
        "y": 520,
        "wires": [
            [
                "7179f6d7.65dc38"
            ]
        ]
    },
    {
        "id": "415fcbb3.f43b64",
        "type": "mongodb out",
        "z": "6472f1e7.097c28",
        "mongodb": "3284a27d.270ace",
        "name": "",
        "collection": "_USERS",
        "payonly": true,
        "upsert": true,
        "multi": true,
        "operation": "delete",
        "x": 1320,
        "y": 520,
        "wires": []
    },
    {
        "id": "36e25ed0.ef5c62",
        "type": "function",
        "z": "6472f1e7.097c28",
        "name": "set msg._id",
        "func": "var payload = msg.payload[0];\nmsg.payload=payload;\nmsg._id = {\"CHIPID\" : msg.payload.CHIPID} ;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1070,
        "y": 520,
        "wires": [
            [
                "415fcbb3.f43b64"
            ]
        ]
    },
    {
        "id": "1b5a7684.761399",
        "type": "mongodb in",
        "z": "6472f1e7.097c28",
        "mongodb": "3284a27d.270ace",
        "name": "",
        "collection": "_USERS",
        "operation": "find",
        "x": 800,
        "y": 520,
        "wires": [
            [
                "36e25ed0.ef5c62"
            ]
        ]
    },
    {
        "id": "84cadee3.6cd28",
        "type": "ui_button",
        "z": "6472f1e7.097c28",
        "name": "",
        "group": "852b60b9.26366",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Usuarios Registrados",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "",
        "x": 320,
        "y": 400,
        "wires": [
            [
                "c3f301cf.abbdb"
            ]
        ]
    },
    {
        "id": "c3f301cf.abbdb",
        "type": "delay",
        "z": "6472f1e7.097c28",
        "name": "",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 530,
        "y": 400,
        "wires": [
            [
                "891c6382.900e"
            ]
        ]
    },
    {
        "id": "891c6382.900e",
        "type": "function",
        "z": "6472f1e7.097c28",
        "name": "agreaga Filtros",
        "func": "\nmsg.payload=\n[\n   { \"$sort\": {\"placa\": 1} }\n];\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 700,
        "y": 400,
        "wires": [
            [
                "b4d409e4.2eeb88"
            ]
        ]
    },
    {
        "id": "b4d409e4.2eeb88",
        "type": "mongodb in",
        "z": "6472f1e7.097c28",
        "mongodb": "3284a27d.270ace",
        "name": "",
        "collection": "_USERS",
        "operation": "aggregate",
        "x": 1000,
        "y": 400,
        "wires": [
            [
                "626abcc.39d6544"
            ]
        ]
    },
    {
        "id": "626abcc.39d6544",
        "type": "function",
        "z": "6472f1e7.097c28",
        "name": "Lista Html dinamica",
        "func": "var ahora = new Date();\nvar desde = new Date(flow.get(\"LOGdesde\") || ahora);\nvar hasta = new Date(flow.get(\"LOGhasta\") || ahora); \n\n/* <h1>LOGs: </h1>\n <ul>\n{{#payload}}\n  <li>   {{Date}} Online: {{Online}} , CHIP_ID:{{CHIPID}} ,Placa: {{Placa}}, Grupo {{Grupo}}    </li>\n{{/payload}}\n </ul>*/\nif(Array.isArray(msg.payload) && msg.payload.length>0)\n\n{\n    mensaje= \"<h1>Usuarios: </h1>\\n <ul> \\n\";\n    for (var i = 0; i < msg.payload.length; i++) \n        { \n            // añade datos al mensaje\n        //Compruebo los datos a escribir\n         mensaje+= \"<li>  \";\n         mensaje+= \"<strong> Placa :</strong>\" + msg.payload[i].placa +\"<br>\" ;\n         mensaje+= \"<strong> Registrado el :</strong>\"+msg.payload[i].date+\"<br>\";\n         mensaje+= \"<strong> CHIP ID :</strong>\" + msg.payload[i].CHIPID ;\n         mensaje+= \"<strong> Grupo :</strong>\" + msg.payload[i].grupo ;  \n         mensaje+=\"<br><br>\";\n        mensaje+= \"</li>  \\n\";\n        }\n    mensaje+=\"   </ul>\";\n    }        \n\nmsg.payload = mensaje;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1330,
        "y": 400,
        "wires": [
            [
                "5a97ef71.fa07d8"
            ]
        ]
    },
    {
        "id": "5a97ef71.fa07d8",
        "type": "ui_template",
        "z": "6472f1e7.097c28",
        "group": "b397c7c9.563d3",
        "name": "",
        "order": 6,
        "width": "18",
        "height": "17",
        "format": "<div ng-bind-html=\"msg.payload\"></div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "templateScope": "local",
        "x": 1620,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "d11f9ed9.d5e308",
        "type": "template",
        "z": "6472f1e7.097c28",
        "name": "reset datos formato html",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": " <h1>LOGs: </h1>\n <ul>\n{{#payload}}\n  <li>      </li>\n{{/payload}}\n </ul>",
        "output": "str",
        "x": 1210,
        "y": 300,
        "wires": [
            [
                "5a97ef71.fa07d8"
            ]
        ]
    },
    {
        "id": "46f605c7.5d067c",
        "type": "function",
        "z": "6472f1e7.097c28",
        "name": "Lista Html dinamica",
        "func": "var ahora = new Date();\nvar desde = new Date(flow.get(\"LOGdesde\") || ahora);\nvar hasta = new Date(flow.get(\"LOGhasta\") || ahora); \n\n/* <h1>LOGs: </h1>\n <ul>\n{{#payload}}\n  <li>   {{Date}} Online: {{Online}} , CHIP_ID:{{CHIPID}} ,Placa: {{Placa}}, Grupo {{Grupo}}    </li>\n{{/payload}}\n </ul>*/\nif(Array.isArray(msg.payload) && msg.payload.length>0)\n\n{\n    mensaje= \"<h1>LOG's: </h1>\\n <ul> \\n\";\n    mensaje += \"<strong> Periodo de busqueda:<br> Desde:</strong>\"+desde+\"<br><strong>Hasta:</strong>\"+hasta+\"<br><br>\"\n    for (var i = 0; i < msg.payload.length; i++) \n        { \n            // añade datos al mensaje\n        //Compruebo los datos a escribir\n         mensaje+= \"<li>  \";\n        if (msg.payload[i].Online===\"true\"){\n            mensaje+= \"<strong> ONLINE :</strong>\";\n        }\n        else{\n            mensaje+= \"<strong> OFFLINE :</strong>\";\n        }\n         mensaje+= msg.payload[i].Date;\n         mensaje+= \"<strong> Placa :</strong>\" + msg.payload[i].Placa ;\n         mensaje+= \"<strong> CHIP ID :</strong>\" + msg.payload[i].CHIPID +\"<br><br>\";\n\n        mensaje+= \"</li>  \\n\";\n        }\n    mensaje+=\"   </ul>\";\n    }        \n\nmsg.payload = mensaje;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1190,
        "y": 260,
        "wires": [
            [
                "5a97ef71.fa07d8"
            ]
        ]
    },
    {
        "id": "20e8b137.2d901e",
        "type": "ui_button",
        "z": "6472f1e7.097c28",
        "name": "",
        "group": "3c571dec.0a71b2",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Limpiar Registros",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "",
        "x": 930,
        "y": 300,
        "wires": [
            [
                "d11f9ed9.d5e308"
            ]
        ]
    },
    {
        "id": "a3a594a9.516c98",
        "type": "inject",
        "z": "6472f1e7.097c28",
        "name": "",
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "x": 1030,
        "y": 360,
        "wires": [
            [
                "d11f9ed9.d5e308"
            ]
        ]
    },
    {
        "id": "b39e5279.8858c",
        "type": "mongodb in",
        "z": "6472f1e7.097c28",
        "mongodb": "3284a27d.270ace",
        "name": "",
        "collection": "_LOGS",
        "operation": "aggregate",
        "x": 950,
        "y": 260,
        "wires": [
            [
                "46f605c7.5d067c"
            ]
        ]
    },
    {
        "id": "d17dfae9.794108",
        "type": "function",
        "z": "6472f1e7.097c28",
        "name": "agreaga Filtros",
        "func": "// fecha por defecto es hoy\nvar ahora = new Date();\n// pillo los globales si los hay, si no la fecha de hoy\nvar desde = new Date(flow.get(\"LOGdesde\") || ahora);\nvar hasta = new Date(flow.get(\"LOGhasta\") || ahora); \n// el día de inicio desde las cero horas\nvar inicio = new Date(desde.getFullYear(),desde.getMonth(),desde.getDate(),1,0,0,0);\n// el día final es hasta final del día\nvar final = new Date(hasta.getFullYear(),hasta.getMonth(),hasta.getDate(),24,59,59,99);\nvar sort = flow.get(\"LOGsort\");\n\n\nmsg.payload=\n[\n    { \"$match\": { \"date\": { \"$gte\": inicio , \"$lte\": final } } },\n    { \"$project\": {\n        \"Date\": \"$date\",\n        \"Online\": \"$online\",\n        \"CHIPID\": \"$CHIPID\",\n        \"Placa\": \"$placa\",\n        \"Grupo\": \"$grupo\"\n        }\n    }\n];\n\nmsg.payload[2]= sort\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 642.6665992736816,
        "y": 259.2333345413208,
        "wires": [
            [
                "b39e5279.8858c"
            ]
        ]
    },
    {
        "id": "eaaf145e.c326a8",
        "type": "delay",
        "z": "6472f1e7.097c28",
        "name": "",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 474.3905715942383,
        "y": 260.3752450942993,
        "wires": [
            [
                "d17dfae9.794108"
            ]
        ]
    },
    {
        "id": "aff286a7.75dc18",
        "type": "ui_button",
        "z": "6472f1e7.097c28",
        "name": "",
        "group": "b397c7c9.563d3",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Buscar LOG's",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "",
        "x": 300,
        "y": 260,
        "wires": [
            [
                "eaaf145e.c326a8",
                "dd1a0e85.1b209"
            ]
        ]
    },
    {
        "id": "dd1a0e85.1b209",
        "type": "function",
        "z": "6472f1e7.097c28",
        "name": "Sort_Obj",
        "func": "\nvar sortBy = flow.get(\"LOGsortby\");\nvar ase_des = flow.get(\"LOGad\");\n\n\n/*\nmsg.payload=\n[\n    { \"$match\": { \"date\": { \"$gte\": inicio , \"$lte\": final } } },\n    { \"$project\": {\n        \"date\": \"$date\",\n        \"STATUS\": \"$online\",\n        \"CHIPID\": \"$CHIPID\",\n        \"placa\": \"$placa\",\n        \"grupo\": \"$grupo\"\n        }\n    },\n    { \"$sort\" : { \"date\" : ase_des } }\n];\n*/\n\nmsg.payload= \" { \\\"$sort\\\" : { \\\"\" + sortBy + \"\\\":\" + ase_des + \"}}\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 480,
        "y": 220,
        "wires": [
            [
                "7c515acd.a455a4"
            ]
        ]
    },
    {
        "id": "7c515acd.a455a4",
        "type": "json",
        "z": "6472f1e7.097c28",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 610,
        "y": 220,
        "wires": [
            [
                "bb4ee3d5.e31a6"
            ]
        ]
    },
    {
        "id": "bb4ee3d5.e31a6",
        "type": "change",
        "z": "6472f1e7.097c28",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "LOGsort",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 770,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "7179f6d7.65dc38",
        "type": "ui_toast",
        "z": "6472f1e7.097c28",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "outputs": 1,
        "ok": "OK",
        "cancel": "Cancelar",
        "topic": "Borrar Usuario",
        "name": "Borrar Usuario",
        "x": 520,
        "y": 520,
        "wires": [
            [
                "1b5a7684.761399"
            ]
        ]
    },
    {
        "id": "3c571dec.0a71b2",
        "type": "ui_group",
        "z": "",
        "name": "FiltersLOG's",
        "tab": "62413fb.117d5c",
        "order": 1,
        "disp": true,
        "width": "5",
        "collapse": false
    },
    {
        "id": "3284a27d.270ace",
        "type": "mongodb",
        "z": "",
        "hostname": "iot.ac.uma.es",
        "port": "27017",
        "db": "II1",
        "name": ""
    },
    {
        "id": "6042ac30.01c774",
        "type": "mqtt-broker",
        "z": "",
        "name": "",
        "broker": "iot.ac.uma.es",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "compatmode": true,
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "willTopic": "",
        "willQos": "0",
        "willPayload": ""
    },
    {
        "id": "852b60b9.26366",
        "type": "ui_group",
        "z": "",
        "name": "Users",
        "tab": "62413fb.117d5c",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "b397c7c9.563d3",
        "type": "ui_group",
        "z": "",
        "name": "Log_Data",
        "tab": "62413fb.117d5c",
        "order": 3,
        "disp": true,
        "width": "18",
        "collapse": false
    },
    {
        "id": "62413fb.117d5c",
        "type": "ui_tab",
        "z": "",
        "name": "LOGs",
        "icon": "dashboard",
        "order": 9,
        "disabled": false,
        "hidden": false
    }
]