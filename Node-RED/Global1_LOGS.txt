[
    {
        "id": "1707ed1f.dc6003",
        "type": "tab",
        "label": "LOGs",
        "disabled": false,
        "info": ""
    },
    {
        "id": "dce4da95.dea608",
        "type": "change",
        "z": "1707ed1f.dc6003",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "LOGhasta",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 530,
        "y": 1080,
        "wires": [
            []
        ]
    },
    {
        "id": "b89ee369.e47f6",
        "type": "ui_date_picker",
        "z": "1707ed1f.dc6003",
        "name": "",
        "label": "Fecha de final",
        "group": "387f1644.c9b6ea",
        "order": 8,
        "width": 0,
        "height": 0,
        "passthru": true,
        "topic": "",
        "x": 300,
        "y": 1080,
        "wires": [
            [
                "dce4da95.dea608"
            ]
        ]
    },
    {
        "id": "6f1d2617.5f3ec8",
        "type": "change",
        "z": "1707ed1f.dc6003",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "LOGdesde",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 530,
        "y": 1040,
        "wires": [
            []
        ]
    },
    {
        "id": "206601f0.aaf88e",
        "type": "ui_date_picker",
        "z": "1707ed1f.dc6003",
        "name": "",
        "label": "Fecha de inicio",
        "group": "387f1644.c9b6ea",
        "order": 6,
        "width": 0,
        "height": 0,
        "passthru": true,
        "topic": "",
        "x": 300,
        "y": 1040,
        "wires": [
            [
                "6f1d2617.5f3ec8"
            ]
        ]
    },
    {
        "id": "bdfcd1e5.51a68",
        "type": "change",
        "z": "1707ed1f.dc6003",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "LOGsortby",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 530,
        "y": 1160,
        "wires": [
            []
        ]
    },
    {
        "id": "98aa000a.c893c",
        "type": "ui_dropdown",
        "z": "1707ed1f.dc6003",
        "name": "",
        "label": "Ordenar Por:",
        "tooltip": "",
        "place": "Select option",
        "group": "387f1644.c9b6ea",
        "order": 11,
        "width": 0,
        "height": 0,
        "passthru": true,
        "options": [
            {
                "label": "Fecha",
                "value": "Date",
                "type": "str"
            },
            {
                "label": "Conexion",
                "value": "Online",
                "type": "str"
            },
            {
                "label": "Placa",
                "value": "Placa",
                "type": "str"
            },
            {
                "label": "CHIP ID",
                "value": "CHIPID",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "",
        "x": 290,
        "y": 1160,
        "wires": [
            [
                "bdfcd1e5.51a68"
            ]
        ]
    },
    {
        "id": "75d494a1.8edaec",
        "type": "ui_switch",
        "z": "1707ed1f.dc6003",
        "name": "",
        "label": "Orden: Des/Asen",
        "tooltip": "",
        "group": "387f1644.c9b6ea",
        "order": 12,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "style": "",
        "onvalue": "1",
        "onvalueType": "num",
        "onicon": "",
        "oncolor": "",
        "offvalue": "-1",
        "offvalueType": "num",
        "officon": "",
        "offcolor": "",
        "x": 310,
        "y": 1120,
        "wires": [
            [
                "1f327be5.7a0154"
            ]
        ]
    },
    {
        "id": "1f327be5.7a0154",
        "type": "change",
        "z": "1707ed1f.dc6003",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "LOGad",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 520,
        "y": 1120,
        "wires": [
            []
        ]
    },
    {
        "id": "fcded72c.733b58",
        "type": "ui_numeric",
        "z": "1707ed1f.dc6003",
        "name": "",
        "label": "Limite Busq.",
        "tooltip": "",
        "group": "387f1644.c9b6ea",
        "order": 10,
        "width": 0,
        "height": 0,
        "passthru": true,
        "topic": "",
        "format": "{{value}}",
        "min": 0,
        "max": "10000",
        "step": 1,
        "x": 290,
        "y": 1200,
        "wires": [
            [
                "5faa1379.2df2dc"
            ]
        ]
    },
    {
        "id": "5faa1379.2df2dc",
        "type": "change",
        "z": "1707ed1f.dc6003",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "LOGlimit",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 530,
        "y": 1200,
        "wires": [
            []
        ]
    },
    {
        "id": "f1d5aaa5.50a908",
        "type": "mongodb out",
        "z": "1707ed1f.dc6003",
        "mongodb": "d76db7c4.ff3f18",
        "name": "",
        "collection": "_USERS",
        "payonly": true,
        "upsert": true,
        "multi": true,
        "operation": "store",
        "x": 1440,
        "y": 700,
        "wires": []
    },
    {
        "id": "3020dd3d.8e46e2",
        "type": "function",
        "z": "1707ed1f.dc6003",
        "name": "set msg._id",
        "func": "msg._id = {\"CHIPID\" : msg.payload.CHIPID} ;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 730,
        "y": 660,
        "wires": [
            [
                "6a466417.a845dc"
            ]
        ]
    },
    {
        "id": "15041baa.cd1564",
        "type": "switch",
        "z": "1707ed1f.dc6003",
        "name": "IsCHIPID",
        "property": "_id",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1020,
        "y": 660,
        "wires": [
            [
                "96417382.a2154",
                "b13e563e.d48848",
                "6c0484c.29d067c"
            ]
        ]
    },
    {
        "id": "425968cf.b92028",
        "type": "link in",
        "z": "1707ed1f.dc6003",
        "name": "USER_conexion",
        "links": [
            "2c54ad31.535242",
            "3a6e3253.6e2e3e",
            "4b719b04.9bff84",
            "64efdf85.5502",
            "77d5aa6e.36d744",
            "d166de5b.65a81"
        ],
        "x": 235,
        "y": 620,
        "wires": [
            [
                "7c046c9d.5b4b74"
            ]
        ]
    },
    {
        "id": "96417382.a2154",
        "type": "switch",
        "z": "1707ed1f.dc6003",
        "name": "IsPLACA",
        "property": "payload.placa",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1220,
        "y": 740,
        "wires": [
            [
                "f1d5aaa5.50a908"
            ],
            [
                "8b78a5d4.08bbb8"
            ]
        ]
    },
    {
        "id": "383d91d9.1383de",
        "type": "mongodb in",
        "z": "1707ed1f.dc6003",
        "mongodb": "d76db7c4.ff3f18",
        "name": "",
        "collection": "_USERS",
        "operation": "count",
        "x": 1440,
        "y": 580,
        "wires": [
            [
                "d38cd8b5.4b2b18"
            ]
        ]
    },
    {
        "id": "b13e563e.d48848",
        "type": "change",
        "z": "1707ed1f.dc6003",
        "name": "set null",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1220,
        "y": 580,
        "wires": [
            [
                "383d91d9.1383de"
            ]
        ]
    },
    {
        "id": "d38cd8b5.4b2b18",
        "type": "change",
        "z": "1707ed1f.dc6003",
        "name": "set flow.numUsers",
        "rules": [
            {
                "t": "set",
                "p": "numUsers",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1850,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "8b78a5d4.08bbb8",
        "type": "function",
        "z": "1707ed1f.dc6003",
        "name": "USER_check",
        "func": "\n\nvar valor = msg.payload.CHIPID;\nmsg.payload={\"CHIPID\":valor};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1370,
        "y": 780,
        "wires": [
            [
                "f06e3a42.9abb88",
                "b0830bd1.3e32c8"
            ]
        ]
    },
    {
        "id": "b0830bd1.3e32c8",
        "type": "mongodb in",
        "z": "1707ed1f.dc6003",
        "mongodb": "d76db7c4.ff3f18",
        "name": "",
        "collection": "_USERS",
        "operation": "count",
        "x": 1740,
        "y": 820,
        "wires": [
            [
                "525166d4.035898"
            ]
        ]
    },
    {
        "id": "525166d4.035898",
        "type": "change",
        "z": "1707ed1f.dc6003",
        "name": "set flow.checkCollision",
        "rules": [
            {
                "t": "set",
                "p": "checkCollision",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2120,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "837aa0c3.cdfed",
        "type": "switch",
        "z": "1707ed1f.dc6003",
        "name": "CheckCollisions",
        "property": "checkCollision",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1840,
        "y": 740,
        "wires": [
            [
                "91e30db2.ffdbe"
            ],
            [
                "2f939899.c491f8",
                "827a0fbd.5a5b6"
            ]
        ]
    },
    {
        "id": "f06e3a42.9abb88",
        "type": "delay",
        "z": "1707ed1f.dc6003",
        "name": "",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1670,
        "y": 740,
        "wires": [
            [
                "837aa0c3.cdfed"
            ]
        ]
    },
    {
        "id": "938781c1.92be6",
        "type": "mqtt out",
        "z": "1707ed1f.dc6003",
        "name": "",
        "topic": "infind/GRUPO1/ESP0/config/placa",
        "qos": "",
        "retain": "",
        "broker": "b479e2b7.21ef3",
        "x": 3320,
        "y": 760,
        "wires": []
    },
    {
        "id": "2f939899.c491f8",
        "type": "function",
        "z": "1707ed1f.dc6003",
        "name": "Recover Data",
        "func": "var ChipID=msg.payload.CHIPID;\n\n\nmsg.payload=\n[\n    { \"$match\": { \"CHIPID\": ChipID } },\n    { \"$project\": {\n        \"CHIPID\": \"$CHIPID\",\n        \"placa\": \"$placa\",\n        \"grupo\": \"$grupo\"\n        }\n    }\n];\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2100,
        "y": 760,
        "wires": [
            [
                "85d11274.04d94"
            ]
        ]
    },
    {
        "id": "85d11274.04d94",
        "type": "mongodb in",
        "z": "1707ed1f.dc6003",
        "mongodb": "d76db7c4.ff3f18",
        "name": "",
        "collection": "_USERS",
        "operation": "aggregate",
        "x": 2340,
        "y": 760,
        "wires": [
            [
                "e41e009c.d5a0e"
            ]
        ]
    },
    {
        "id": "e41e009c.d5a0e",
        "type": "function",
        "z": "1707ed1f.dc6003",
        "name": "ARRAY[0]2OBJECT",
        "func": "\nvar payload = msg.payload[0];\nmsg.payload=payload;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2600,
        "y": 760,
        "wires": [
            [
                "34af9a1b.6b5cd6"
            ]
        ]
    },
    {
        "id": "6a466417.a845dc",
        "type": "function",
        "z": "1707ed1f.dc6003",
        "name": "+ fecha",
        "func": "\nmsg.payload.date = new Date();\n\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 880,
        "y": 660,
        "wires": [
            [
                "15041baa.cd1564"
            ]
        ]
    },
    {
        "id": "1c67d925.638d57",
        "type": "function",
        "z": "1707ed1f.dc6003",
        "name": "newPlaca",
        "func": "var ChipID=msg.payload.CHIPID;\nvar date = msg.payload.date;\nvar numUsers = flow.get(\"numUsers\");\nvar placa = numUsers + 1 ;\n\n\nmsg.payload=\n{\n    \"CHIPID\":ChipID,\n    \"grupo\" : 1,\n    \"placa\":placa,\n    \"date\":date\n    \n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2380,
        "y": 660,
        "wires": [
            [
                "e47afb9c.0a29d8"
            ]
        ]
    },
    {
        "id": "3f3fc892.fd5d98",
        "type": "change",
        "z": "1707ed1f.dc6003",
        "name": "",
        "rules": [
            {
                "t": "delete",
                "p": "payload._id",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3043.7585525512695,
        "y": 759.9727783203125,
        "wires": [
            [
                "938781c1.92be6"
            ]
        ]
    },
    {
        "id": "6c0484c.29d067c",
        "type": "change",
        "z": "1707ed1f.dc6003",
        "name": "set flow.oldPlaca",
        "rules": [
            {
                "t": "set",
                "p": "oldPlaca",
                "pt": "flow",
                "to": "payload.placa",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1250,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "34af9a1b.6b5cd6",
        "type": "switch",
        "z": "1707ed1f.dc6003",
        "name": "check ChangePlaca",
        "property": "payload.placa",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "oldPlaca",
                "vt": "flow"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 2820,
        "y": 760,
        "wires": [
            [
                "3f3fc892.fd5d98"
            ]
        ]
    },
    {
        "id": "7c046c9d.5b4b74",
        "type": "switch",
        "z": "1707ed1f.dc6003",
        "name": "check Online conection",
        "property": "payload.online",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 390,
        "y": 620,
        "wires": [
            [
                "a60bf779.45c508"
            ]
        ]
    },
    {
        "id": "91e30db2.ffdbe",
        "type": "function",
        "z": "1707ed1f.dc6003",
        "name": "set msg._id",
        "func": "msg._id = {\"CHIPID\" : msg.payload.CHIPID} ;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2090,
        "y": 660,
        "wires": [
            [
                "b86eb0ab.5adff"
            ]
        ]
    },
    {
        "id": "b86eb0ab.5adff",
        "type": "function",
        "z": "1707ed1f.dc6003",
        "name": "+ fecha",
        "func": "\nmsg.payload.date = new Date();\n\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2240,
        "y": 660,
        "wires": [
            [
                "1c67d925.638d57"
            ]
        ]
    },
    {
        "id": "e47afb9c.0a29d8",
        "type": "mongodb out",
        "z": "1707ed1f.dc6003",
        "mongodb": "d76db7c4.ff3f18",
        "name": "",
        "collection": "_USERS",
        "payonly": true,
        "upsert": true,
        "multi": true,
        "operation": "store",
        "x": 2600,
        "y": 660,
        "wires": []
    },
    {
        "id": "827a0fbd.5a5b6",
        "type": "function",
        "z": "1707ed1f.dc6003",
        "name": "Placa_check",
        "func": "\n\nvar valor = msg.payload.placa;\nmsg.payload={\"placa\":valor};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2089.765739440918,
        "y": 708.2500658035278,
        "wires": [
            [
                "8d13bfd6.99dde"
            ]
        ]
    },
    {
        "id": "8d13bfd6.99dde",
        "type": "mongodb in",
        "z": "1707ed1f.dc6003",
        "mongodb": "d76db7c4.ff3f18",
        "name": "",
        "collection": "_USERS",
        "operation": "count",
        "x": 2319.0156860351562,
        "y": 706.250075340271,
        "wires": [
            [
                "976dad30.70c7e"
            ]
        ]
    },
    {
        "id": "976dad30.70c7e",
        "type": "change",
        "z": "1707ed1f.dc6003",
        "name": "set flow.checkPlacaCollision",
        "rules": [
            {
                "t": "set",
                "p": "checkPlacaCollision",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2590.7656898498535,
        "y": 705.2501363754272,
        "wires": [
            []
        ]
    },
    {
        "id": "a60bf779.45c508",
        "type": "function",
        "z": "1707ed1f.dc6003",
        "name": "set format",
        "func": "var CHIPID = msg.payload.CHIPID;\nvar GRUPO = msg.payload.grupo;\nvar PLACA = msg.payload.placa;\n\nmsg.payload={};\nmsg.payload.CHIPID= CHIPID;\nmsg.payload.grupo=GRUPO\nmsg.payload.placa=PLACA\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 580,
        "y": 660,
        "wires": [
            [
                "3020dd3d.8e46e2"
            ]
        ]
    },
    {
        "id": "4378bae4.fa77a4",
        "type": "ui_form",
        "z": "1707ed1f.dc6003",
        "name": "",
        "label": "Nuevo Usuario",
        "group": "f70b8f28.48cc6",
        "order": 2,
        "width": 0,
        "height": 0,
        "options": [
            {
                "label": "CHIP ID",
                "value": "CHIPID",
                "type": "text",
                "required": true
            },
            {
                "label": "Placa",
                "value": "placa",
                "type": "text",
                "required": true
            },
            {
                "label": "Grupo",
                "value": "grupo",
                "type": "text",
                "required": false
            }
        ],
        "formValue": {
            "CHIPID": "",
            "placa": "",
            "grupo": ""
        },
        "payload": "",
        "submit": "Añadir/Modificar(por CHIPID)",
        "cancel": "Cancelar",
        "topic": "",
        "x": 300,
        "y": 660,
        "wires": [
            [
                "a60bf779.45c508"
            ]
        ]
    },
    {
        "id": "3a3fb5bf.5ed55a",
        "type": "ui_form",
        "z": "1707ed1f.dc6003",
        "name": "",
        "label": "Borrar Usuario",
        "group": "f70b8f28.48cc6",
        "order": 3,
        "width": "6",
        "height": "3",
        "options": [
            {
                "label": "Placa",
                "value": "placa",
                "type": "text",
                "required": true
            }
        ],
        "formValue": {
            "placa": ""
        },
        "payload": "",
        "submit": "Borrar Usuario",
        "cancel": "Cancelar",
        "topic": "",
        "x": 300,
        "y": 520,
        "wires": [
            [
                "84e94c11.fc793"
            ]
        ]
    },
    {
        "id": "71900a12.3ce3b4",
        "type": "mongodb out",
        "z": "1707ed1f.dc6003",
        "mongodb": "d76db7c4.ff3f18",
        "name": "",
        "collection": "_USERS",
        "payonly": true,
        "upsert": true,
        "multi": true,
        "operation": "delete",
        "x": 1440,
        "y": 520,
        "wires": []
    },
    {
        "id": "fdb9b16c.2e9c6",
        "type": "function",
        "z": "1707ed1f.dc6003",
        "name": "set msg._id",
        "func": "var usr = msg.payload[0];\nmsg.payload=usr;\nmsg._id =  msg.payload.CHIPID ;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1070,
        "y": 520,
        "wires": [
            [
                "71900a12.3ce3b4"
            ]
        ]
    },
    {
        "id": "84e94c11.fc793",
        "type": "mongodb in",
        "z": "1707ed1f.dc6003",
        "mongodb": "d76db7c4.ff3f18",
        "name": "",
        "collection": "_USERS",
        "operation": "find",
        "x": 800,
        "y": 520,
        "wires": [
            [
                "fdb9b16c.2e9c6"
            ]
        ]
    },
    {
        "id": "fb504f04.05cd9",
        "type": "ui_button",
        "z": "1707ed1f.dc6003",
        "name": "",
        "group": "f70b8f28.48cc6",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Usuarios Registrados",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "",
        "x": 320,
        "y": 400,
        "wires": [
            [
                "d6ec7752.d3aac8"
            ]
        ]
    },
    {
        "id": "d6ec7752.d3aac8",
        "type": "delay",
        "z": "1707ed1f.dc6003",
        "name": "",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 530,
        "y": 400,
        "wires": [
            [
                "c274a44.2aa2a58"
            ]
        ]
    },
    {
        "id": "c274a44.2aa2a58",
        "type": "function",
        "z": "1707ed1f.dc6003",
        "name": "agreaga Filtros",
        "func": "\nmsg.payload=\n[\n   { \"$sort\": {\"placa\": 1} }\n];\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 700,
        "y": 400,
        "wires": [
            [
                "f78cbac.57bee48"
            ]
        ]
    },
    {
        "id": "f78cbac.57bee48",
        "type": "mongodb in",
        "z": "1707ed1f.dc6003",
        "mongodb": "d76db7c4.ff3f18",
        "name": "",
        "collection": "_USERS",
        "operation": "aggregate",
        "x": 1440,
        "y": 400,
        "wires": [
            [
                "1946a5e.095cf5a"
            ]
        ]
    },
    {
        "id": "1946a5e.095cf5a",
        "type": "function",
        "z": "1707ed1f.dc6003",
        "name": "Lista Html dinamica",
        "func": "var ahora = new Date();\nvar desde = new Date(flow.get(\"LOGdesde\") || ahora);\nvar hasta = new Date(flow.get(\"LOGhasta\") || ahora); \n\n/* <h1>LOGs: </h1>\n <ul>\n{{#payload}}\n  <li>   {{Date}} Online: {{Online}} , CHIP_ID:{{CHIPID}} ,Placa: {{Placa}}, Grupo {{Grupo}}    </li>\n{{/payload}}\n </ul>*/\nif(Array.isArray(msg.payload) && msg.payload.length>0)\n\n{\n  var  mensaje= \"<h1>Usuarios: </h1>\\n <ul> \\n\";\n    for (var i = 0; i < msg.payload.length; i++) \n        { \n            // añade datos al mensaje\n        //Compruebo los datos a escribir\n         mensaje+= \"<li>  \";\n         mensaje+= \"<strong> Placa :</strong>\" + msg.payload[i].placa +\"<br>\" ;\n         mensaje+= \"<strong> Registrado el :</strong>\"+msg.payload[i].date+\"<br>\";\n         mensaje+= \"<strong> CHIP ID :</strong>\" + msg.payload[i].CHIPID ;\n         mensaje+= \"<strong> Grupo :</strong>\" + msg.payload[i].grupo ;  \n         mensaje+=\"<br><br>\";\n        mensaje+= \"</li>  \\n\";\n        }\n    mensaje+=\"   </ul>\";\n    }        \n\nmsg.payload = mensaje;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1770,
        "y": 400,
        "wires": [
            [
                "e7207515.327dc8"
            ]
        ]
    },
    {
        "id": "e7207515.327dc8",
        "type": "ui_template",
        "z": "1707ed1f.dc6003",
        "group": "468de40c.b8c23c",
        "name": "",
        "order": 6,
        "width": "18",
        "height": "17",
        "format": "<div ng-bind-html=\"msg.payload\"></div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "templateScope": "local",
        "x": 2060,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "14251fe6.0ec27",
        "type": "template",
        "z": "1707ed1f.dc6003",
        "name": "reset datos formato html",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": " <h1>LOGs: </h1>\n <ul>\n{{#payload}}\n  <li>      </li>\n{{/payload}}\n </ul>",
        "output": "str",
        "x": 1690,
        "y": 320,
        "wires": [
            [
                "e7207515.327dc8"
            ]
        ]
    },
    {
        "id": "34efd190.a0961e",
        "type": "function",
        "z": "1707ed1f.dc6003",
        "name": "Lista Html dinamica",
        "func": "var ahora = new Date();\nvar desde = new Date(flow.get(\"LOGdesde\") || ahora);\nvar hasta = new Date(flow.get(\"LOGhasta\") || ahora); \n\n/* <h1>LOGs: </h1>\n <ul>\n{{#payload}}\n  <li>   {{Date}} Online: {{Online}} , CHIP_ID:{{CHIPID}} ,Placa: {{Placa}}, Grupo {{Grupo}}    </li>\n{{/payload}}\n </ul>*/\nif(Array.isArray(msg.payload) && msg.payload.length>0)\n\n{\n  var  mensaje= \"<h1>LOG's: </h1>\\n <ul> \\n\";\n    mensaje += \"<strong> Periodo de busqueda:<br> Desde:</strong>\"+desde+\"<br><strong>Hasta:</strong>\"+hasta+\"<br><br>\"\n    for (var i = 0; i < msg.payload.length; i++) \n        { \n            // añade datos al mensaje\n        //Compruebo los datos a escribir\n         mensaje+= \"<li>  \";\n        if (msg.payload[i].Online===\"true\"){\n            mensaje+= \"<strong> ONLINE :</strong>\";\n        }\n        else{\n            mensaje+= \"<strong> OFFLINE :</strong>\";\n        }\n         mensaje+= msg.payload[i].Date;\n         mensaje+= \"<strong> Placa :</strong>\" + msg.payload[i].Placa ;\n         mensaje+= \"<strong> CHIP ID :</strong>\" + msg.payload[i].CHIPID +\"<br><br>\";\n\n        mensaje+= \"</li>  \\n\";\n        }\n    mensaje+=\"   </ul>\";\n    }        \n\nmsg.payload = mensaje;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1810,
        "y": 260,
        "wires": [
            [
                "e7207515.327dc8"
            ]
        ]
    },
    {
        "id": "f64455ad.26d2f8",
        "type": "ui_button",
        "z": "1707ed1f.dc6003",
        "name": "",
        "group": "387f1644.c9b6ea",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Limpiar Registros",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "",
        "x": 1390,
        "y": 320,
        "wires": [
            [
                "14251fe6.0ec27"
            ]
        ]
    },
    {
        "id": "c3a3b402.4cfed8",
        "type": "inject",
        "z": "1707ed1f.dc6003",
        "name": "",
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "x": 1470,
        "y": 360,
        "wires": [
            [
                "14251fe6.0ec27"
            ]
        ]
    },
    {
        "id": "3355cc0e.3118f4",
        "type": "mongodb in",
        "z": "1707ed1f.dc6003",
        "mongodb": "d76db7c4.ff3f18",
        "name": "",
        "collection": "_LOGS",
        "operation": "aggregate",
        "x": 1430,
        "y": 260,
        "wires": [
            [
                "34efd190.a0961e"
            ]
        ]
    },
    {
        "id": "ca341f9.9ddfbe",
        "type": "function",
        "z": "1707ed1f.dc6003",
        "name": "agreaga Filtros",
        "func": "// fecha por defecto es hoy\nvar ahora = new Date();\n// pillo los globales si los hay, si no la fecha de hoy\nvar desde = new Date(flow.get(\"LOGdesde\") || ahora);\nvar hasta = new Date(flow.get(\"LOGhasta\") || ahora); \n// el día de inicio desde las cero horas\nvar inicio = new Date(desde.getFullYear(),desde.getMonth(),desde.getDate(),1,0,0,0);\n// el día final es hasta final del día\nvar final = new Date(hasta.getFullYear(),hasta.getMonth(),hasta.getDate(),24,59,59,99);\nvar sort = flow.get(\"LOGsort\");\n\n\nmsg.payload=\n[\n    { \"$match\": { \"date\": { \"$gte\": inicio , \"$lte\": final } } },\n    { \"$project\": {\n        \"Date\": \"$date\",\n        \"Online\": \"$online\",\n        \"CHIPID\": \"$CHIPID\",\n        \"Placa\": \"$placa\",\n        \"Grupo\": \"$grupo\"\n        }\n    }\n];\n\nmsg.payload[2]= sort\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 642.6665992736816,
        "y": 259.2333345413208,
        "wires": [
            [
                "3355cc0e.3118f4"
            ]
        ]
    },
    {
        "id": "e3f70fb8.1f445",
        "type": "delay",
        "z": "1707ed1f.dc6003",
        "name": "",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 474.3905715942383,
        "y": 260.3752450942993,
        "wires": [
            [
                "ca341f9.9ddfbe"
            ]
        ]
    },
    {
        "id": "ae31b083.1ce0f",
        "type": "ui_button",
        "z": "1707ed1f.dc6003",
        "name": "",
        "group": "468de40c.b8c23c",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Buscar LOG's",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "",
        "x": 300,
        "y": 260,
        "wires": [
            [
                "e3f70fb8.1f445",
                "8f6e0785.c1ced8"
            ]
        ]
    },
    {
        "id": "8f6e0785.c1ced8",
        "type": "function",
        "z": "1707ed1f.dc6003",
        "name": "Sort_Obj",
        "func": "\nvar sortBy = flow.get(\"LOGsortby\");\nvar ase_des = flow.get(\"LOGad\");\n\n\n/*\nmsg.payload=\n[\n    { \"$match\": { \"date\": { \"$gte\": inicio , \"$lte\": final } } },\n    { \"$project\": {\n        \"date\": \"$date\",\n        \"STATUS\": \"$online\",\n        \"CHIPID\": \"$CHIPID\",\n        \"placa\": \"$placa\",\n        \"grupo\": \"$grupo\"\n        }\n    },\n    { \"$sort\" : { \"date\" : ase_des } }\n];\n*/\n\nmsg.payload= \" { \\\"$sort\\\" : { \\\"\" + sortBy + \"\\\":\" + ase_des + \"}}\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 480,
        "y": 220,
        "wires": [
            [
                "7d63d2b8.fb868c"
            ]
        ]
    },
    {
        "id": "7d63d2b8.fb868c",
        "type": "json",
        "z": "1707ed1f.dc6003",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 610,
        "y": 220,
        "wires": [
            [
                "fd66341e.d9ca38"
            ]
        ]
    },
    {
        "id": "fd66341e.d9ca38",
        "type": "change",
        "z": "1707ed1f.dc6003",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "LOGsort",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 770,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "6c146bd8.b78614",
        "type": "ui_template",
        "z": "1707ed1f.dc6003",
        "group": "387f1644.c9b6ea",
        "name": "CSV_LOG's",
        "order": 2,
        "width": "0",
        "height": "0",
        "format": "<style>\n.button {\n    text-align: center;\n    font: bold 17px Arial;\n    text-decoration: none;\n    background-color: #339966;\n    color: white;\n    padding: 8px 10px;\n    border: 2px solid #CCCCCC;\n  }\n  \n  .button:hover\n  {\n   background-color: #26734d;\n  }\n\n</style>\n<a href=\"/LOGs\" class=\"button\">Descarga LOG's en CSV (EXCEL)</a>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "templateScope": "local",
        "x": 290,
        "y": 900,
        "wires": [
            []
        ]
    },
    {
        "id": "bd761658.4a8c58",
        "type": "http in",
        "z": "1707ed1f.dc6003",
        "name": "",
        "url": "/LOGs",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 510,
        "y": 900,
        "wires": [
            [
                "5b0c47f5.68d908",
                "104c274c.8f4279"
            ]
        ]
    },
    {
        "id": "cbb4dc35.e1dd7",
        "type": "csv",
        "z": "1707ed1f.dc6003",
        "name": "",
        "sep": ";",
        "hdrin": "",
        "hdrout": true,
        "multi": "one",
        "ret": "\\r\\n",
        "temp": "Date,CHIPID,Placa,Online,Grupo",
        "skip": 0,
        "x": 1290,
        "y": 900,
        "wires": [
            [
                "e716ad23.c1a18"
            ]
        ]
    },
    {
        "id": "e716ad23.c1a18",
        "type": "function",
        "z": "1707ed1f.dc6003",
        "name": "Unicode y separador",
        "func": "//add Unicode BOM character (byte order mark) to make EXCEL knows this is UTF-8\nif(flow.get(\"separador_decimal\")==\"punto\")\n{\n    msg.payload='\\ufeff'+msg.payload;\n\n}\nelse\n{\n    msg.payload='\\ufeff'+(msg.payload).replace(/\\./g,\",\");\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1460,
        "y": 900,
        "wires": [
            [
                "4a27850.fb9bd7c"
            ]
        ]
    },
    {
        "id": "4a27850.fb9bd7c",
        "type": "http response",
        "z": "1707ed1f.dc6003",
        "name": "",
        "statusCode": "",
        "headers": {
            "Content-Disposition": "attachment; filename=LOGs.csv"
        },
        "x": 1630,
        "y": 900,
        "wires": []
    },
    {
        "id": "b121c2a5.79aa5",
        "type": "mongodb in",
        "z": "1707ed1f.dc6003",
        "mongodb": "d76db7c4.ff3f18",
        "name": "",
        "collection": "_LOGS",
        "operation": "aggregate",
        "x": 1070,
        "y": 900,
        "wires": [
            [
                "cbb4dc35.e1dd7"
            ]
        ]
    },
    {
        "id": "104c274c.8f4279",
        "type": "function",
        "z": "1707ed1f.dc6003",
        "name": "agreaga Filtros",
        "func": "// fecha por defecto es hoy\nvar ahora = new Date();\n// pillo los globales si los hay, si no la fecha de hoy\nvar desde = new Date(flow.get(\"LOGdesde\") || ahora);\nvar hasta = new Date(flow.get(\"LOGhasta\") || ahora); \n// el día de inicio desde las cero horas\nvar inicio = new Date(desde.getFullYear(),desde.getMonth(),desde.getDate(),1,0,0,0);\n// el día final es hasta final del día\nvar final = new Date(hasta.getFullYear(),hasta.getMonth(),hasta.getDate(),24,59,59,99);\nvar sort = flow.get(\"LOGsort\");\n\n\nmsg.payload=\n[\n    { \"$match\": { \"date\": { \"$gte\": inicio , \"$lte\": final } } },\n    { \"$project\": {\n        \"Date\": \"$date\",\n        \"Online\": \"$online\",\n        \"CHIPID\": \"$CHIPID\",\n        \"Placa\": \"$placa\",\n        \"Grupo\": \"$grupo\"\n        }\n    }\n];\n\nmsg.payload[2]= sort\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 740,
        "y": 900,
        "wires": [
            [
                "b121c2a5.79aa5"
            ]
        ]
    },
    {
        "id": "5b0c47f5.68d908",
        "type": "function",
        "z": "1707ed1f.dc6003",
        "name": "Sort_Obj",
        "func": "\nvar sortBy = flow.get(\"LOGsortby\");\nvar ase_des = flow.get(\"LOGad\");\n\n\n/*\nmsg.payload=\n[\n    { \"$match\": { \"date\": { \"$gte\": inicio , \"$lte\": final } } },\n    { \"$project\": {\n        \"date\": \"$date\",\n        \"STATUS\": \"$online\",\n        \"CHIPID\": \"$CHIPID\",\n        \"placa\": \"$placa\",\n        \"grupo\": \"$grupo\"\n        }\n    },\n    { \"$sort\" : { \"date\" : ase_des } }\n];\n*/\n\nmsg.payload= \" { \\\"$sort\\\" : { \\\"\" + sortBy + \"\\\":\" + ase_des + \"}}\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 720,
        "y": 860,
        "wires": [
            [
                "7ab47a64.6dca54"
            ]
        ]
    },
    {
        "id": "7ab47a64.6dca54",
        "type": "json",
        "z": "1707ed1f.dc6003",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 990,
        "y": 860,
        "wires": [
            [
                "7e3e3abf.8df194"
            ]
        ]
    },
    {
        "id": "7e3e3abf.8df194",
        "type": "change",
        "z": "1707ed1f.dc6003",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "LOGsort",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1150,
        "y": 860,
        "wires": [
            []
        ]
    },
    {
        "id": "65688cc4.6033f4",
        "type": "http in",
        "z": "1707ed1f.dc6003",
        "name": "",
        "url": "/Users",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 510,
        "y": 960,
        "wires": [
            [
                "8b5db409.34cab8"
            ]
        ]
    },
    {
        "id": "3e4a804a.fa2c8",
        "type": "mongodb in",
        "z": "1707ed1f.dc6003",
        "mongodb": "d76db7c4.ff3f18",
        "name": "",
        "collection": "_USERS",
        "operation": "aggregate",
        "x": 1080,
        "y": 960,
        "wires": [
            [
                "db7ac100.d6456"
            ]
        ]
    },
    {
        "id": "db7ac100.d6456",
        "type": "csv",
        "z": "1707ed1f.dc6003",
        "name": "",
        "sep": ";",
        "hdrin": "",
        "hdrout": true,
        "multi": "one",
        "ret": "\\r\\n",
        "temp": "CHIPID,placa,grupo,date",
        "skip": 0,
        "x": 1290,
        "y": 960,
        "wires": [
            [
                "475ec945.969678"
            ]
        ]
    },
    {
        "id": "475ec945.969678",
        "type": "function",
        "z": "1707ed1f.dc6003",
        "name": "Unicode y separador",
        "func": "//add Unicode BOM character (byte order mark) to make EXCEL knows this is UTF-8\nif(flow.get(\"separador_decimal\")==\"punto\")\n{\n    msg.payload='\\ufeff'+msg.payload;\n\n}\nelse\n{\n    msg.payload='\\ufeff'+(msg.payload).replace(/\\./g,\",\");\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1460,
        "y": 960,
        "wires": [
            [
                "831fd43e.f40518"
            ]
        ]
    },
    {
        "id": "831fd43e.f40518",
        "type": "http response",
        "z": "1707ed1f.dc6003",
        "name": "",
        "statusCode": "",
        "headers": {
            "Content-Disposition": "attachment; filename=Users.csv"
        },
        "x": 1630,
        "y": 960,
        "wires": []
    },
    {
        "id": "c223391.ba779c8",
        "type": "ui_template",
        "z": "1707ed1f.dc6003",
        "group": "387f1644.c9b6ea",
        "name": "CSV_Users",
        "order": 3,
        "width": "0",
        "height": "0",
        "format": "<style>\n.button {\n    text-align: center;\n    font: bold 17px Arial;\n    text-decoration: none;\n    background-color: #339966;\n    color: white;\n    padding: 8px 10px;\n    border: 2px solid #CCCCCC;\n  }\n  \n  .button:hover\n  {\n   background-color: #26734d;\n  }\n\n</style>\n<a href=\"/Users\" class=\"button\">Descarga Usuarios en CSV (EXCEL)</a>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "templateScope": "local",
        "x": 290,
        "y": 960,
        "wires": [
            []
        ]
    },
    {
        "id": "8b5db409.34cab8",
        "type": "function",
        "z": "1707ed1f.dc6003",
        "name": "agreaga Filtros",
        "func": "\nmsg.payload=\n[\n   { \"$sort\": {\"placa\": 1} }\n];\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 740,
        "y": 960,
        "wires": [
            [
                "3e4a804a.fa2c8"
            ]
        ]
    },
    {
        "id": "387f1644.c9b6ea",
        "type": "ui_group",
        "z": "",
        "name": "FiltersLOG's",
        "tab": "d0b4b0c2.9451b",
        "order": 1,
        "disp": true,
        "width": "5",
        "collapse": false
    },
    {
        "id": "d76db7c4.ff3f18",
        "type": "mongodb",
        "z": "",
        "hostname": "iot.ac.uma.es",
        "port": "27017",
        "db": "II1",
        "name": ""
    },
    {
        "id": "b479e2b7.21ef3",
        "type": "mqtt-broker",
        "z": "",
        "name": "",
        "broker": "iot.ac.uma.es",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "compatmode": true,
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "willTopic": "",
        "willQos": "0",
        "willPayload": ""
    },
    {
        "id": "f70b8f28.48cc6",
        "type": "ui_group",
        "z": "",
        "name": "Users",
        "tab": "d0b4b0c2.9451b",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "468de40c.b8c23c",
        "type": "ui_group",
        "z": "",
        "name": "Log_Data",
        "tab": "d0b4b0c2.9451b",
        "order": 3,
        "disp": true,
        "width": "18",
        "collapse": false
    },
    {
        "id": "d0b4b0c2.9451b",
        "type": "ui_tab",
        "z": "",
        "name": "LOGs",
        "icon": "dashboard",
        "order": 9,
        "disabled": false,
        "hidden": false
    }
]